var G=Object.defineProperty,H=Object.defineProperties;var L=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var U=(c,l,r)=>l in c?G(c,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):c[l]=r,O=(c,l)=>{for(var r in l||(l={}))I.call(l,r)&&U(c,r,l[r]);if(M)for(var r of M(l))W.call(l,r)&&U(c,r,l[r]);return c},S=(c,l)=>H(c,L(l));var V=(c,l,r)=>new Promise((v,e)=>{var g=d=>{try{w(r.next(d))}catch(m){e(m)}},D=d=>{try{w(r.throw(d))}catch(m){e(m)}},w=d=>d.done?v(d.value):Promise.resolve(d.value).then(g,D);w((r=r.apply(c,l)).next())});import{P as J}from"./index.0248b5d5.js";import{A as k,r as A,P as C,bG as T,_ as X,a0 as _,B as $,D as N,H as E,w as t,u as n,a6 as a,ae as y,$ as Q,j as Y,bq as Z,bV as P,bu as ee,J as j,a4 as z,ab as te,t as oe,bA as ne,a1 as ae}from"./vendor.af2fe88b.js";/* empty css               */import{u as re,B as ue,a as le}from"./index.22b4830b.js";import{u as se}from"./index.df186f99.js";import{ah as B}from"./index.6733effe.js";import{O as ie}from"./OrgModal.be27269d.js";import{c as de,a as ce,d as me,e as fe}from"./list.fd3e66c9.js";/* empty css               *//* empty css                */import"./useWindowSizeFn.4124f9cf.js";import"./useContentViewHeight.b4e0fa30.js";/* empty css               *//* empty css               *//* empty css              */import"./index.ddcbdb3f.js";import"./useContextMenu.0181a98a.js";/* empty css               */const pe={class:"bg-white overflow-hidden ztree"},ge={style:{"margin-bottom":"4px"}},xe=y("\u5C55\u5F00"),_e=y("\u6298\u53E0"),he=y("\u6D4B\u8BD5"),ve={style:{border:"1px solid #ddd"}},we=k({props:{menuArr:{type:Array}},emits:["select"],setup(c,{expose:l,emit:r}){const v=A({}),e=C({filterName:"",tableData:[],originData:[],tableTreeConfig:{children:"children",rowKey:"id",indent:15,parentKey:"pid",iconOpen:"vxe-icon--arrow-bottom",iconClose:"vxe-icon--arrow-right"}}),g=()=>{const x=T.toValueString(e.filterName).trim();if(x){const i={children:"children"},b=["name"];e.tableData=T.searchTree(e.originData,s=>b.some(o=>T.toValueString(s[o]).indexOf(x)>-1),i),Q(()=>{v.value.setAllTreeExpand(!0)})}else e.tableData=e.originData},D=T.debounce(function(){g()},500,{leading:!1,trailing:!0});function w(){return V(this,null,function*(){e.originData=yield B.get({url:"/sys/auth/menu/tree"}),g()})}X(()=>{w()});function d(){const x=v.value,i=x.getCheckboxRecords();x.getCheckboxIndeterminateRecords(),console.log(i);const b=[];for(const s of i)b.push({id:s.id,name:s.name});return b}function m(){v.value.reloadData(e.originData)}return l({getMenus:d,reloadTree:m}),(x,i)=>{const b=_("vxe-input"),s=_("vxe-button"),o=_("vxe-column"),f=_("vxe-table");return $(),N("div",pe,[E("div",ge,[t(b,{modelValue:n(e).filterName,"onUpdate:modelValue":i[0]||(i[0]=h=>n(e).filterName=h),placeholder:"\u641C\u7D22",type:"type",onKeyup:n(D)},null,8,["modelValue","onKeyup"]),t(s,{onClick:i[1]||(i[1]=h=>x.$refs.xTree.setAllTreeExpand(!0))},{default:a(()=>[xe]),_:1}),t(s,{onClick:i[2]||(i[2]=h=>x.$refs.xTree.clearTreeExpand())},{default:a(()=>[_e]),_:1}),t(s,{onClick:d},{default:a(()=>[he]),_:1})]),E("div",ve,[t(f,{ref:(h,F)=>{F.xTree=h,v.value=h},resizable:"","show-overflow":"","row-key":"","row-id":"id",border:"none",size:"mini",height:"600px","highlight-current-row":"","highlight-hover-row":"","show-header":!1,"checkbox-config":{labelField:"name",checkRowKeys:c.menuArr,checkStrictly:!0},"row-config":{height:26},"tree-config":n(e).tableTreeConfig,data:n(e).tableData},{default:a(()=>[t(o,{type:"checkbox","tree-node":""})]),_:1},8,["checkbox-config","tree-config","data"])])])}}}),be=E("span",null,"\u57FA\u672C\u4FE1\u606F",-1),Fe=E("span",null,"\u83DC\u5355\u5206\u914D",-1),De=k({emits:["success","register"],setup(c,{emit:l}){const[r,{openModal:v}]=se(),e=C({menuArr:[],loadingText:"",url:"/sys/auth/role",data:{},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{min:1,max:20,message:"\u957F\u5EA6\u5728 1 \u5230 20 \u4E2A\u5B57\u7B26"}],sex:[{required:!0,message:"\u8BF7\u9009\u62E9\u6027\u522B"}]}}),g=A({}),[D,{setDrawerProps:w,changeLoading:d,closeDrawer:m}]=re(o=>V(this,null,function*(){if(e.loadingText="\u52A0\u8F7D\u4E2D",d(!0),o.record.id?o.record=yield B.get({url:e.url+"/one/"+o.record.id}):o.record.avtag=!0,e.menuArr.splice(0,e.menuArr.length),o.record.menus)for(const f of o.record.menus)e.menuArr.push(f.id);e.data=o.record,g&&g.value&&g.value.reloadTree&&g.value.reloadTree(),d(!1)}));function x(){v(!0,{opener:"orgs",orgType:10,selectMode:2,orgs:e.data.orgs?[...oe(e.data.orgs)]:[]})}const i=Y(()=>{let o="";if(e.data.orgs&&e.data.orgs.length>0)for(const f of e.data.orgs)o+=f.name+"\uFF1B";return o});function b(o){o.opener=="orgs"&&(e.data.orgs=o.orgs)}function s(o,f){o.validate(function(h){return V(this,null,function*(){if(h==null)try{w({confirmLoading:!0}),e.loadingText="\u4FDD\u5B58\u4E2D",f!=null&&(e.data.menus=f.getMenus()),d(!0),e.data.id?yield B.put({url:e.url,data:e.data}):yield B.post({url:e.url,data:e.data}),m(),l("success")}finally{w({confirmLoading:!1}),d(!1)}else ne.modal.message({content:"\u6821\u9A8C\u5F02\u5E38\u8BF7\u4FEE\u6539",status:"warning"})})})}return(o,f)=>{const h=_("vxe-input"),F=_("vxe-form-item"),R=_("vxe-textarea"),q=_("vxe-switch"),K=_("vxe-form");return $(),N(te,null,[t(n(ue),z(o.$attrs,{loadingText:n(e).loadingText,showFooter:"",title:"\u89D2\u8272\u4FE1\u606F",width:"70%",onOk:f[1]||(f[1]=u=>s(o.$refs.xForm,o.$refs.xMenuTree)),onRegister:n(D)}),{default:a(()=>[t(K,{"custom-layout":"","title-colon":"",ref:(u,p)=>{p.xForm=u},"title-align":"right","title-width":"100",data:n(e).data,rules:n(e).rules},{default:a(()=>[t(n(Z),{type:"card"},{default:a(()=>[t(n(P),{key:"1",class:"vxe-row"},{tab:a(()=>[be]),default:a(()=>[t(F,{title:"\u89D2\u8272\u540D\u79F0",field:"name","item-render":{},span:"12","title-width":"150"},{default:a(({data:u})=>[t(h,{modelValue:u.name,"onUpdate:modelValue":p=>u.name=p,clearable:"",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(F,{title:"\u6307\u6D3E\u7528\u6237",field:"orgs","item-render":{},span:"24","title-width":"150"},{default:a(({data:u})=>[t(R,{modelValue:n(i),"onUpdate:modelValue":f[0]||(f[0]=p=>ee(i)?i.value=p:null),placeholder:"\u8BF7\u9009\u62E9\u6210\u5458",autosize:{minRows:4,maxRows:6},onClick:x,readonly:""},null,8,["modelValue"])]),_:1}),t(F,{title:"\u662F\u5426\u53EF\u7528",field:"avtag","item-render":{},span:"12","title-width":"150"},{default:a(({data:u})=>[t(q,{modelValue:u.avtag,"onUpdate:modelValue":p=>u.avtag=p,"open-label":"\u662F","close-label":"\u5426"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(F,{title:"\u6392\u5E8F\u53F7",field:"ornum","item-render":{},span:"12","title-width":"150"},{default:a(({data:u})=>[t(h,{modelValue:u.ornum,"onUpdate:modelValue":p=>u.ornum=p,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(F,{title:"\u89D2\u8272\u5907\u6CE8",field:"notes","item-render":{},span:"24","title-width":"150"},{default:a(({data:u})=>[t(R,{modelValue:u.notes,"onUpdate:modelValue":p=>u.notes=p,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",autosize:{minRows:4,maxRows:6},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(F,{title:"\u521B\u5EFA\u65F6\u95F4",field:"crtim","item-render":{},span:"12","title-width":"150"},{default:a(({data:u})=>[y(j(u.crtim),1)]),_:1}),t(F,{title:"\u66F4\u65B0\u65F6\u95F4",field:"uptim","item-render":{},span:"12","title-width":"150"},{default:a(({data:u})=>[y(j(u.uptim),1)]),_:1})]),_:1}),t(n(P),{key:"2",class:"vxe-row"},{tab:a(()=>[Fe]),default:a(()=>[t(we,{ref:(u,p)=>{p.xMenuTree=u,g.value=u},menuArr:n(e).menuArr},null,8,["menuArr"])]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1},16,["loadingText","onRegister"]),t(ie,{onRegister:n(r),onCloseModal:b},null,8,["onRegister"])],64)}}}),ye=y("\u67E5 \u8BE2"),Ee=y("\u65B0 \u589E"),Ve=y("\u5220 \u9664"),Ce=["onClick"],Te={name:"SysOrgRole",inheritAttrs:!1,customOptions:{}};function Be(c){const l=A({}),r=C({name:""}),v=C(de("/sys/auth/role",{},r,[{type:"checkbox",align:"center",width:42,fixed:"left"},{type:"seq",align:"center",width:50,fixed:"left"},{field:"name",title:"\u89D2\u8272\u540D\u79F0",width:300,fixed:"left",slots:{default:"name_default"}},{field:"notes",title:"\u5907\u6CE8"},{field:"crtim",title:"\u521B\u5EFA\u65F6\u95F4",width:140},{field:"uptim",title:"\u66F4\u65B0\u65F6\u95F4",width:140}])),e=()=>{l.value.commitProxy("query")},[g,{openDrawer:D}]=le();function w(){e()}return(d,m)=>{const x=_("vxe-input"),i=_("vxe-button"),b=_("vxe-grid");return $(),ae(n(J),{class:"ztable",contentFullHeight:""},{default:a(()=>[t(b,z({ref:(s,o)=>{o.xGrid=s,l.value=s}},n(v)),{tbtns:a(()=>[t(x,{modelValue:n(r).name,"onUpdate:modelValue":m[0]||(m[0]=s=>n(r).name=s),placeholder:"\u8F93\u5165\u540D\u79F0\u67E5\u8BE2"},null,8,["modelValue"]),t(i,{onClick:e,status:"primary"},{default:a(()=>[ye]),_:1}),t(i,{onClick:m[1]||(m[1]=s=>n(ce)({},n(D)))},{default:a(()=>[Ee]),_:1}),t(i,{onClick:m[2]||(m[2]=s=>n(me)(d.$refs.xGrid))},{default:a(()=>[Ve]),_:1})]),name_default:a(({row:s})=>[E("span",{style:{cursor:"pointer",color:"#3e9ece"},onClick:o=>n(fe)({id:s.id},n(D))},j(s.name),9,Ce)]),_:1},16),t(De,{onRegister:n(g),onSuccess:w},null,8,["onRegister"])]),_:1})}}const Je=k(S(O({},Te),{setup:Be}));export{Je as default};
