var v=(V,x,m)=>new Promise((F,e)=>{var i=l=>{try{p(m.next(l))}catch(f){e(f)}},w=l=>{try{p(m.throw(l))}catch(f){e(f)}},p=l=>l.done?F(l.value):Promise.resolve(l.value).then(i,w);p((m=m.apply(V,x)).next())});import{A as R,P as U,r as k,j as O,a0 as c,B as z,D as N,w as o,a5 as u,u as s,bp as P,bE as E,bt as S,ad as b,J as j,a4 as $,aa as H,H as B,t as L,bz as q}from"./vendor.a4547d8e.js";/* empty css               */import{a as I,B as J}from"./index.f06a4b68.js";import{u as W}from"./index.5f1c2524.js";import{ah as h}from"./index.49385d3b.js";import{O as X}from"./OrgModal.179b5c8d.js";import G from"./MenuTree.dbc7411d.js";/* empty css               */import"./useWindowSizeFn.01f243df.js";/* empty css               *//* empty css              */import"./Tree.vue_vue&type=style&index=0&lang.156930fd.js";/* empty css               */import"./index.0aef37d2.js";/* empty css               *//* empty css               */import"./useContentViewHeight.7c57433e.js";const K=B("span",null,"\u57FA\u672C\u4FE1\u606F",-1),Q=B("span",null,"\u83DC\u5355\u5206\u914D",-1),xe=R({emits:["success","register"],setup(V,{emit:x}){const[m,{openModal:F}]=W(),e=U({menuArr:[],loadingText:"",url:"/sys/auth/role",data:{},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"},{min:1,max:20,message:"\u957F\u5EA6\u5728 1 \u5230 20 \u4E2A\u5B57\u7B26"}],sex:[{required:!0,message:"\u8BF7\u9009\u62E9\u6027\u522B"}]}}),i=k({}),[w,{setDrawerProps:p,changeLoading:l,closeDrawer:f}]=I(a=>v(this,null,function*(){if(e.loadingText="\u52A0\u8F7D\u4E2D",l(!0),a.record.id?a.record=yield h.get({url:e.url+"/one/"+a.record.id}):a.record.avtag=!0,e.menuArr.splice(0,e.menuArr.length),a.record.menus)for(const n of a.record.menus)e.menuArr.push(n.id);e.data=a.record,i&&i.value&&i.value.reloadTree&&i.value.reloadTree(),l(!1)}));function T(){F(!0,{opener:"orgs",orgType:10,selectMode:2,orgs:e.data.orgs?[...L(e.data.orgs)]:[]})}const _=O(()=>{let a="";if(e.data.orgs&&e.data.orgs.length>0)for(const n of e.data.orgs)a+=n.name+"\uFF1B";return a});function y(a){a.opener=="orgs"&&(e.data.orgs=a.orgs)}function A(a,n){a.validate(function(g){return v(this,null,function*(){if(g==null)try{p({confirmLoading:!0}),e.loadingText="\u4FDD\u5B58\u4E2D",n!=null&&(e.data.menus=n.getMenus()),l(!0),e.data.id?yield h.put({url:e.url,data:e.data}):yield h.post({url:e.url,data:e.data}),f(),x("success")}finally{p({confirmLoading:!1}),l(!1)}else q.modal.message({content:"\u6821\u9A8C\u5F02\u5E38\u8BF7\u4FEE\u6539",status:"warning"})})})}return(a,n)=>{const g=c("vxe-input"),d=c("vxe-form-item"),D=c("vxe-textarea"),M=c("vxe-switch"),C=c("vxe-form");return z(),N(H,null,[o(s(J),$(a.$attrs,{loadingText:s(e).loadingText,showFooter:"",title:"\u89D2\u8272\u4FE1\u606F",width:"70%",onOk:n[1]||(n[1]=t=>A(a.$refs.xForm,a.$refs.xMenuTree)),onRegister:s(w)}),{default:u(()=>[o(C,{"custom-layout":"","title-colon":"",ref:(t,r)=>{r.xForm=t},"title-align":"right","title-width":"100",data:s(e).data,rules:s(e).rules},{default:u(()=>[o(s(P),{type:"card"},{default:u(()=>[o(s(E),{key:"1",class:"vxe-row"},{tab:u(()=>[K]),default:u(()=>[o(d,{title:"\u89D2\u8272\u540D\u79F0",field:"name","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[o(g,{modelValue:t.name,"onUpdate:modelValue":r=>t.name=r,clearable:"",style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{title:"\u6307\u6D3E\u7528\u6237",field:"orgs","item-render":{},span:"24","title-width":"150"},{default:u(({data:t})=>[o(D,{modelValue:s(_),"onUpdate:modelValue":n[0]||(n[0]=r=>S(_)?_.value=r:null),placeholder:"\u8BF7\u9009\u62E9\u6210\u5458",autosize:{minRows:4,maxRows:6},onClick:T,readonly:""},null,8,["modelValue"])]),_:1}),o(d,{title:"\u662F\u5426\u53EF\u7528",field:"avtag","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[o(M,{modelValue:t.avtag,"onUpdate:modelValue":r=>t.avtag=r,"open-label":"\u662F","close-label":"\u5426"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{title:"\u6392\u5E8F\u53F7",field:"ornum","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[o(g,{modelValue:t.ornum,"onUpdate:modelValue":r=>t.ornum=r,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{title:"\u89D2\u8272\u5907\u6CE8",field:"notes","item-render":{},span:"24","title-width":"150"},{default:u(({data:t})=>[o(D,{modelValue:t.notes,"onUpdate:modelValue":r=>t.notes=r,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",autosize:{minRows:4,maxRows:6},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(d,{title:"\u521B\u5EFA\u65F6\u95F4",field:"crtim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[b(j(t.crtim),1)]),_:1}),o(d,{title:"\u66F4\u65B0\u65F6\u95F4",field:"uptim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[b(j(t.uptim),1)]),_:1})]),_:1}),o(s(E),{key:"2",class:"vxe-row"},{tab:u(()=>[Q]),default:u(()=>[o(G,{ref:(t,r)=>{r.xMenuTree=t,i.value=t},menuArr:s(e).menuArr},null,8,["menuArr"])]),_:1})]),_:1})]),_:1},8,["data","rules"])]),_:1},16,["loadingText","onRegister"]),o(X,{onRegister:s(m),onCloseModal:y},null,8,["onRegister"])],64)}}});export{xe as default};
