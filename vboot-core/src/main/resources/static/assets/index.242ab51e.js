var A=Object.defineProperty,R=Object.defineProperties;var G=Object.getOwnPropertyDescriptors;var T=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,K=Object.prototype.propertyIsEnumerable;var U=(m,l,e)=>l in m?A(m,l,{enumerable:!0,configurable:!0,writable:!0,value:e}):m[l]=e,S=(m,l)=>{for(var e in l||(l={}))H.call(l,e)&&U(m,e,l[e]);if(T)for(var e of T(l))K.call(l,e)&&U(m,e,l[e]);return m},N=(m,l)=>R(m,G(l));var $=(m,l,e)=>new Promise((w,g)=>{var C=f=>{try{h(e.next(f))}catch(_){g(_)}},s=f=>{try{h(e.throw(f))}catch(_){g(_)}},h=f=>f.done?w(f.value):Promise.resolve(f.value).then(C,s);h((e=e.apply(m,l)).next())});import{P as M}from"./index.0248b5d5.js";import{ah as P,k as q}from"./index.6733effe.js";import{A as j,r as V,P as y,bG as k,_ as L,a0 as x,B,D as W,H as b,w as n,u as a,a6 as u,J as D,$ as I,j as J,a1 as O,ae as F,a4 as z,bB as Q}from"./vendor.af2fe88b.js";import{u as X,B as Y,a as Z}from"./index.22b4830b.js";import{u as ee}from"./index.df186f99.js";import{h as te}from"./edit.e0eb6616.js";import{_ as ne}from"./TreeModal.720af3a3.js";import{c as ae,a as oe,d as le,e as ie}from"./list.fd3e66c9.js";/* empty css               *//* empty css                */import"./useWindowSizeFn.4124f9cf.js";import"./useContentViewHeight.b4e0fa30.js";/* empty css               */const re={class:"bg-white m-4 mr-0 overflow-hidden zcate"},se={class:"flex px-2 py-1.5 items-center basic-tree-header"},ue={class:"flex flex-1 justify-self-stretch items-center cursor-pointer"},de=b("hr",null,null,-1),ce=j({emits:["select"],setup(m,{emit:l}){const e=V({}),w=({column:r,row:o,triggerTreeNode:c})=>{c||(e.value.toggleTreeExpand(o),l("select",{id:o.id,name:o.name}))};function g(){l("select",null)}function C(){_()}V("");const s=y({filterName:"",tableData:[],originData:[],tableTreeConfig:{children:"children",rowKey:"id",indent:15,parentKey:"pid",iconOpen:"vxe-icon--arrow-bottom",iconClose:"vxe-icon--arrow-right"}}),h=()=>{const r=k.toValueString(s.filterName).trim();if(r){const o={children:"children"},c=["name"];s.tableData=k.searchTree(s.originData,d=>c.some(v=>k.toValueString(d[v]).indexOf(r)>-1),o),I(()=>{e.value.setAllTreeExpand(!0)})}else s.tableData=s.originData},f=k.debounce(function(){h()},500,{leading:!1,trailing:!0});function _(){return $(this,null,function*(){s.originData=yield P.get({url:"/ps/proj/cate/tree"}),h()})}return L(()=>{_()}),(r,o)=>{const c=x("vxe-input"),d=x("vxe-button"),v=x("vxe-column"),E=x("vxe-table");return B(),W("div",re,[b("div",se,[b("div",ue,[n(c,{modelValue:a(s).filterName,"onUpdate:modelValue":o[0]||(o[0]=i=>a(s).filterName=i),placeholder:"\u641C\u7D22",style:{width:"120px"},type:"type",onKeyup:a(f)},null,8,["modelValue","onKeyup"]),n(d,{icon:"vxe-icon--refresh",title:"\u5237\u65B0",circle:"",onClick:C,style:{"margin-left":"4px","margin-right":"2px"}}),n(d,{icon:"vxe-icon--dot",title:"\u6839\u76EE\u5F55",circle:"",onClick:g,style:{"margin-left":"2px","margin-right":"2px"}}),n(d,{icon:"vxe-icon--caret-bottom",title:"\u5C55\u5F00",circle:"",onClick:o[1]||(o[1]=i=>r.$refs.xCate.setAllTreeExpand(!0)),style:{"margin-left":"2px","margin-right":"2px"}}),n(d,{icon:"vxe-icon--caret-top",title:"\u6298\u53E0",circle:"",onClick:o[2]||(o[2]=i=>r.$refs.xCate.clearTreeExpand()),style:{"margin-left":"2px","margin-right":"2px"}})])]),de,n(E,{ref:(i,t)=>{t.xCate=i,e.value=i},resizable:"","show-overflow":"","row-key":"",border:"none",size:"mini",height:"auto","highlight-current-row":"","highlight-hover-row":"","show-header":!1,onCellClick:w,"row-config":{height:26},"tree-config":a(s).tableTreeConfig,data:a(s).tableData},{default:u(()=>[n(v,{field:"name",title:"Name","tree-node":""},{default:u(({row:i})=>[b("span",null,D(i.name),1)]),_:1})]),_:1},8,["tree-config","data"])])}}});const me=j({emits:["success","register"],setup(m,{emit:l}){ee();const e=y({loadingText:"",url:"/ps/proj/main",data:{},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}]}}),w=V({});J(()=>e.data.cate?e.data.cate.name:"");const[g,{setDrawerProps:C,changeLoading:s,closeDrawer:h}]=X(r=>$(this,null,function*(){e.loadingText="\u52A0\u8F7D\u4E2D",s(!0),r.record.id?(e.data=yield P.get({url:e.url+"/one/"+r.record.id}),e.data.cate!=null&&(e.data.catename=e.data.cate.name)):(e.data=r.record,e.data.cate&&e.data.cate.id===""&&(e.data.cate=null),e.data.avtag=!0),s(!1)}));function f(){w.value.open({url:"/ps/proj/cate/tree"})}function _(r){e.data.cate=r,r!=null?(e.data.catename=r.name,e.data.cateid=r.id):(e.data.catename=null,e.data.cateid=null)}return(r,o)=>{const c=x("vxe-input"),d=x("vxe-form-item"),v=x("vxe-switch"),E=x("vxe-textarea"),i=x("vxe-form");return B(),O(a(Y),z(r.$attrs,{loadingText:a(e).loadingText,showFooter:"",title:"\u9879\u76EE\u4FE1\u606F",width:"70%",onOk:o[0]||(o[0]=t=>a(te)(r.$refs.xForm,a(e),l,a(C),a(s),a(h))),onRegister:a(g)}),{default:u(()=>[n(i,{"title-colon":"",ref:(t,p)=>{p.xForm=t},"title-align":"right","title-width":"100",data:a(e).data,rules:a(e).rules,loading:a(e).loading},{default:u(()=>[n(d,{title:"\u9879\u76EE\u540D\u79F0",field:"name","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[n(c,{modelValue:t.name,"onUpdate:modelValue":p=>t.name=p,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(d,{title:"\u6240\u5C5E\u5206\u7C7B",field:"catename","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[n(c,{modelValue:t.catename,"onUpdate:modelValue":p=>t.catename=p,"suffix-icon":"vxe-icon--search",readonly:"",onClick:f},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(d,{title:"\u662F\u5426\u53EF\u7528",field:"avtag","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[n(v,{modelValue:t.avtag,"onUpdate:modelValue":p=>t.avtag=p,"open-label":"\u662F","close-label":"\u5426"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(d,{title:"\u6392\u5E8F\u53F7",field:"ornum","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[n(c,{modelValue:t.ornum,"onUpdate:modelValue":p=>t.ornum=p,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(d,{title:"\u9879\u76EE\u5907\u6CE8",field:"notes","item-render":{},span:"24","title-width":"150"},{default:u(({data:t})=>[n(E,{modelValue:t.notes,"onUpdate:modelValue":p=>t.notes=p,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",autosize:{minRows:4,maxRows:6},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(d,{title:"\u521B\u5EFA\u65F6\u95F4",field:"crtim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[F(D(t.crtim),1)]),_:1}),n(d,{title:"\u66F4\u65B0\u65F6\u95F4",field:"uptim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[F(D(t.uptim),1)]),_:1})]),_:1},8,["data","rules","loading"]),n(ne,{ref:(t,p)=>{p.xTree=t,w.value=t},onSelect:_},null,512)]),_:1},16,["loadingText","onRegister"])}}}),fe={class:"w-3/4 xl:w-4/5 ztable"},pe=F("\u67E5 \u8BE2"),xe=F("\u65B0 \u589E"),_e=F("\u5220 \u9664"),ge=["onClick"],he={name:"PsProjMain",inheritAttrs:!1,customOptions:{}};function ve(m){const l=V({}),e=y({name:"",cateid:"",catename:""}),w=y(ae("/ps/proj/main",{},e,[{type:"checkbox",align:"center",width:42,fixed:"left"},{type:"seq",align:"center",width:50,fixed:"left"},{field:"name",title:"\u9879\u76EE\u540D\u79F0",width:300,fixed:"left",slots:{default:"name_default"}},{field:"notes",title:"\u5907\u6CE8"},{field:"crtim",title:"\u521B\u5EFA\u65F6\u95F4",width:140},{field:"uptim",title:"\u66F4\u65B0\u65F6\u95F4",width:140},{title:"\u64CD\u4F5C",width:60,align:"center",slots:{default:"go_task"}}])),g=()=>{l.value.commitProxy("query")};function C(o){o!=null?(e.cateid=o.id,e.catename=o.name):(e.cateid="",e.catename=""),g()}const s=q(),h=o=>{s("/ps/task/main/"+o)},[f,{openDrawer:_}]=Z();function r(){g()}return(o,c)=>{const d=x("vxe-input"),v=x("vxe-button"),E=x("vxe-grid");return B(),O(a(M),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:u(()=>[n(ce,{class:"w-1/4 xl:w-1/5",onSelect:C,style:{margin:"6px 0 6px 6px"}}),b("div",fe,[n(E,z({ref:(i,t)=>{t.xGrid=i,l.value=i}},a(w)),{tbtns:u(()=>[n(d,{modelValue:a(e).name,"onUpdate:modelValue":c[0]||(c[0]=i=>a(e).name=i),placeholder:"\u8F93\u5165\u540D\u79F0\u67E5\u8BE2"},null,8,["modelValue"]),n(v,{onClick:g,status:"primary"},{default:u(()=>[pe]),_:1}),n(v,{onClick:c[1]||(c[1]=i=>a(oe)({cate:{id:a(e).cateid,name:a(e).catename}},a(_)))},{default:u(()=>[xe]),_:1}),n(v,{onClick:c[2]||(c[2]=i=>a(le)(o.$refs.xGrid))},{default:u(()=>[_e]),_:1})]),name_default:u(({row:i})=>[b("span",{style:{cursor:"pointer",color:"#3e9ece"},onClick:t=>a(ie)({id:i.id},a(_))},D(i.name),9,ge)]),go_task:u(({row:i})=>[n(a(Q),{onClick:t=>h(i.id),style:{"font-size":"15px",color:"#3e9ece"}},null,8,["onClick"])]),_:1},16)]),n(me,{onRegister:a(f),onSuccess:r},null,8,["onRegister"])]),_:1})}}const Se=j(N(S({},he),{setup:ve}));export{Se as default};
