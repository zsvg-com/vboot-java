var ae=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var le=Object.prototype.hasOwnProperty,ie=Object.prototype.propertyIsEnumerable;var K=(v,r,e)=>r in v?ae(v,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):v[r]=e,J=(v,r)=>{for(var e in r||(r={}))le.call(r,e)&&K(v,e,r[e]);if(q)for(var e of q(r))ie.call(r,e)&&K(v,e,r[e]);return v},G=(v,r)=>ne(v,oe(r));var y=(v,r,e)=>new Promise((m,h)=>{var V=x=>{try{_(e.next(x))}catch(p){h(p)}},F=x=>{try{_(e.throw(x))}catch(p){h(p)}},_=x=>x.done?m(x.value):Promise.resolve(x.value).then(V,F);_((e=e.apply(v,r)).next())});import{P as se}from"./index.0248b5d5.js";import{A as H,r as M,P as N,$ as O,aj as L,_ as W,a0 as g,B as P,D as re,H as b,w as a,u as s,a6 as u,bI as X,bJ as Q,ae as j,bA as A,j as ue,a1 as Y,J as Z,a4 as de,bG as k,bH as ce}from"./vendor.af2fe88b.js";import ee from"./sortable.esm.526c5d42.js";import{ah as C,u as pe}from"./index.6733effe.js";import{u as me,B as xe,a as fe}from"./index.22b4830b.js";import{u as ge}from"./index.df186f99.js";import{h as _e}from"./edit.e0eb6616.js";import{_ as ve}from"./TreeModal.720af3a3.js";import{e as be}from"./list.fd3e66c9.js";/* empty css               *//* empty css                */import"./useWindowSizeFn.4124f9cf.js";import"./useContentViewHeight.b4e0fa30.js";/* empty css               */const we={class:"bg-white m-4 mr-0 overflow-hidden zcate"},ye={class:"flex px-2 py-1.5 items-center basic-tree-header"},he={class:"flex flex-1 justify-self-stretch items-center cursor-pointer"},Fe=j(" \u9879\u76EE\uFF1A "),Ee=b("hr",null,null,-1),Te={style:{margin:"4px"},class:"proj-tree"},De=b("span",{class:"drag-btn",style:{"text-align":"center"}},[b("i",{class:"vxe-icon--menu"})],-1),Be=H({emits:["select"],setup(v,{emit:r}){const e=M({}),m=N({showHelpTip:!1,projid:"",loading:!1,projname:"",projs:[],stages:[]});let h;const V=()=>{const t=e.value;h=ee.create(t.$el.querySelector(".body--wrapper>.vxe-table--body tbody"),{handle:".drag-btn",onEnd:o=>{const T=o.newIndex,D=o.oldIndex,B=m.tableData.splice(D,1)[0];m.tableData.splice(T,0,B)}})};let F;O(()=>{F=setTimeout(()=>{V()},500)}),L(()=>{clearTimeout(F),h&&h.destroy()});function _(){return y(this,null,function*(){m.projs=yield C.get({url:"/ps/proj/main/list"})})}W(()=>{_()});let x="";function p(t){return y(this,null,function*(){console.log(t.value),x=t.value,m.stages=yield C.get({url:"/ps/proj/stage/list?projid="+x})})}const z=t=>y(this,null,function*(){if(x==""){yield A.modal.message({content:"\u8BF7\u5148\u9009\u62E9\u9879\u76EE",status:"warning"});return}const o=e.value,T={id:S().replaceAll("-",""),name:"",type:"new",projid:x},{row:D}=yield o.insertAt(T,t);yield o.setActiveCell(D,"name")}),$=t=>{e.value.setActiveRow(t)},E=T=>y(this,[T],function*({row:t,column:o}){const D=e.value,B=o.property;t[B],t.type=="new"?(console.log("\u65B0\u589E\u7684\u6BCF\u6B21\u90FD\u53BB\u66F4\u65B0"),yield C.post({url:"/ps/proj/stage",data:t})):D.isUpdateByRow(t,B)&&(console.log("\u4FEE\u6539"),yield C.put({url:"/ps/proj/stage",data:t}))});function S(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){let o=Math.random()*16|0;return(t=="x"?o:o&3|8).toString(16)})}const I=({column:t,row:o,triggerTreeNode:T})=>{r("select",{id:o.id,name:o.name})},U=t=>y(this,null,function*(){(yield A.modal.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u6570\u636E?"))==="confirm"&&(yield e.value.remove(t))});return(t,o)=>{const T=g("vxe-select"),D=g("vxe-button"),B=g("vxe-tooltip"),n=g("vxe-column"),l=g("vxe-input"),d=g("vxe-table");return P(),re("div",we,[b("div",ye,[b("div",he,[b("div",null,[Fe,a(T,{modelValue:s(m).projid,"onUpdate:modelValue":o[0]||(o[0]=i=>s(m).projid=i),style:{width:"182px"},options:s(m).projs,size:"medium",onChange:p},null,8,["modelValue","options"]),a(D,{icon:"vxe-icon--plus",title:"\u65B0\u589E\u9636\u6BB5",circle:"",onClick:o[1]||(o[1]=i=>z(-1)),style:{"margin-left":"6px","margin-right":"0"}})])])]),Ee,b("div",Te,[a(d,{border:"none",size:"mini","show-header":!1,"highlight-current-row":"","highlight-hover-row":"","row-key":"","keep-source":"",ref:(i,f)=>{f.xTable=i,e.value=i},class:"sortable-row-demo",onCellClick:I,"edit-config":{trigger:"manual",mode:"row"},"scroll-y":{enabled:!1},onEditClosed:E,data:s(m).stages},{default:u(()=>[a(n,{width:"20"},{default:u(()=>[De]),header:u(()=>[a(B,{modelValue:s(m).showHelpTip,"onUpdate:modelValue":o[3]||(o[3]=i=>s(m).showHelpTip=i),content:"\u6309\u4F4F\u540E\u53EF\u4EE5\u4E0A\u4E0B\u62D6\u52A8\u6392\u5E8F\uFF01",enterable:""},{default:u(()=>[b("i",{class:"vxe-icon--question",onClick:o[2]||(o[2]=i=>s(m).showHelpTip=!s(m).showHelpTip)})]),_:1},8,["modelValue"])]),_:1}),a(n,{field:"name",title:"name","edit-render":{},width:"192"},{edit:u(({row:i})=>[a(l,{modelValue:i.name,"onUpdate:modelValue":f=>i.name=f,type:"text",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",size:"mini"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(n,{title:"\u64CD\u4F5C",width:"60"},{default:u(({row:i})=>[a(s(X),{onClick:f=>$(i),style:{"font-size":"15px","margin-left":"11px",color:"#2874C5"}},null,8,["onClick"]),a(s(Q),{onClick:f=>U(i),style:{"font-size":"15px","margin-left":"10px",color:"#ED6F6F"}},null,8,["onClick"])]),_:1})]),_:1},8,["data"])])])}}});const Ce=H({emits:["success","register"],setup(v,{emit:r}){ge();const e=N({loadingText:"",url:"/ps/task/main",data:{},rules:{name:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}]}}),m=M({});ue(()=>e.data.cate?e.data.cate.name:"");const[h,{setDrawerProps:V,changeLoading:F,closeDrawer:_}]=me(p=>y(this,null,function*(){e.loadingText="\u52A0\u8F7D\u4E2D",F(!0),p.record.id?(e.data=yield C.get({url:e.url+"/one/"+p.record.id}),e.data.cate!=null&&(e.data.cname=e.data.cate.name)):(e.data=p.record,e.data.cate&&e.data.cate.id===""&&(e.data.cate=null),e.data.avtag=!0),F(!1)}));function x(p){e.data.cate=p,p!=null?e.data.cname=p.name:e.data.cname=null}return(p,z)=>{const $=g("vxe-input"),E=g("vxe-form-item"),S=g("vxe-switch"),I=g("vxe-textarea"),U=g("vxe-form");return P(),Y(s(xe),de(p.$attrs,{loadingText:s(e).loadingText,showFooter:"",title:"\u4EFB\u52A1\u4FE1\u606F",width:"70%",onOk:z[0]||(z[0]=t=>s(_e)(p.$refs.xForm,s(e),r,s(V),s(F),s(_))),onRegister:s(h)}),{default:u(()=>[a(U,{"title-colon":"",ref:(t,o)=>{o.xForm=t},"title-align":"right","title-width":"100",data:s(e).data,rules:s(e).rules,loading:s(e).loading},{default:u(()=>[a(E,{title:"\u4EFB\u52A1\u540D\u79F0",field:"name","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[a($,{modelValue:t.name,"onUpdate:modelValue":o=>t.name=o,clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(E,{title:"\u662F\u5426\u53EF\u7528",field:"avtag","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[a(S,{modelValue:t.avtag,"onUpdate:modelValue":o=>t.avtag=o,"open-label":"\u662F","close-label":"\u5426"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(E,{title:"\u6392\u5E8F\u53F7",field:"ornum","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[a($,{modelValue:t.ornum,"onUpdate:modelValue":o=>t.ornum=o,type:"number"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(E,{title:"\u4EFB\u52A1\u5907\u6CE8",field:"notes","item-render":{},span:"24","title-width":"150"},{default:u(({data:t})=>[a(I,{modelValue:t.notes,"onUpdate:modelValue":o=>t.notes=o,placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8",autosize:{minRows:4,maxRows:6},clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(E,{title:"\u521B\u5EFA\u65F6\u95F4",field:"crtim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[j(Z(t.crtim),1)]),_:1}),a(E,{title:"\u66F4\u65B0\u65F6\u95F4",field:"uptim","item-render":{},span:"12","title-width":"150"},{default:u(({data:t})=>[j(Z(t.uptim),1)]),_:1})]),_:1},8,["data","rules","loading"]),a(ve,{ref:(t,o)=>{o.xTree=t,m.value=t},onSelect:x},null,512)]),_:1},16,["loadingText","onRegister"])}}}),Ve={class:"ztable",style:{flex:"1"}},$e=j("\u67E5 \u8BE2"),je=j("\u65B0 \u589E"),Ae=j("\u5C55 \u5F00"),ke=j("\u6298 \u53E0"),ze=b("i",{class:"vxe-button--icon vxe-icon--upload"},null,-1),Ie=[ze],Se=b("span",{class:"drag-btn",style:{"text-align":"center"}},[b("i",{class:"vxe-icon--menu"})],-1),Ue={name:"PsTaskMain",inheritAttrs:!1,customOptions:{}};function Re(v){const r=N({filterName:"",tableData:[{id:1e4,parentId:null,name:"test abc1",type:"mp3",size:1024,date:"2020-08-01"},{id:10050,parentId:null,name:"Test2",type:"mp4",size:null,date:"2021-04-01"},{id:24300,parentId:10050,name:"Test3",type:"avi",size:1024,date:"2020-03-01"},{id:20045,parentId:24300,name:"test abc4",type:"html",size:600,date:"2021-04-01"},{id:10053,parentId:24300,name:"test abc96",type:"avi",size:null,date:"2021-04-01"},{id:24330,parentId:10053,name:"test abc5",type:"txt",size:25,date:"2021-10-01"},{id:21011,parentId:10053,name:"Test6",type:"pdf",size:512,date:"2020-01-01"},{id:22200,parentId:10053,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23666,parentId:null,name:"Test8",type:"xlsx",size:2048,date:"2020-11-01"},{id:23677,parentId:23666,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23671,parentId:23677,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23672,parentId:23677,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23688,parentId:23666,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23681,parentId:23688,name:"Test7",type:"js",size:1024,date:"2021-06-01"},{id:23682,parentId:23688,name:"Test7",type:"js",size:1024,date:"2021-06-01"}],originData:[],tableTreeConfig:{transform:!0,children:"children",rowKey:"id",indent:15,parentKey:"parentId",iconOpen:"vxe-icon--arrow-bottom",iconClose:"vxe-icon--arrow-right"}});let e="";function m(n){return y(this,null,function*(){console.log(n),n&&n.id?(e=n.id,r.tableData=yield C.get({url:"/ps/task/main?stageid="+n.id})):e=""})}const[h,{openDrawer:V}]=fe();function F(n){console.log(n),t()}const _=M({}),x=M({});let p;const z=()=>{const n=_.value;p=ee.create(n.$el.querySelector(".body--wrapper>.vxe-table--body tbody"),{handle:".drag-btn",onEnd:l=>{const d=l.newIndex,i=l.oldIndex,f=r.tableData.splice(i,1)[0];r.tableData.splice(d,0,f)}})},{apiUrl:$}=pe(),E={remote:!0,types:["xlsx"],modes:["current","selected","all"],exportMethod({options:n}){C.getAxios().request({url:$+"/ps/task/main/exp/11",method:"get",data:{},responseType:"blob"}).then(l=>{let d=new Blob([Object.prototype.toString.call(l.data).toLowerCase()==="[object object]"?JSON.stringify(l.data):l.data]);A.saveFile({filename:n.filename,type:n.type,content:d})}).catch(()=>{A.modal.message({content:"\u5BFC\u51FA\u5931\u8D25\uFF01",status:"error"})})}},S=()=>y(this,null,function*(){const{file:n}=yield A.readFile();new FormData().append("file",n),yield C.uploadFile({url:$+"/ps/task/main/imp"},{file:n})});let I;O(()=>{I=setTimeout(()=>{z()},500)}),W(()=>{const n=_.value,l=x.value;n.connect(l)}),L(()=>{clearTimeout(I),p&&p.destroy()});const U=()=>{const n=k.toValueString(r.filterName).trim();if(n){const l={children:"children"},d=["name"];r.tableData=k.searchTree(r.originData,i=>d.some(f=>k.toValueString(i[f]).indexOf(n)>-1),l),O(()=>{_.value.setAllTreeExpand(!0)})}else r.tableData=r.originData},t=k.debounce(function(){U()},500,{leading:!1,trailing:!0}),o=n=>y(this,null,function*(){if(e==""){yield A.modal.message({content:"\u8BF7\u5148\u9009\u62E9\u9636\u6BB5",status:"warning"});return}const l=_.value,d={id:B().replaceAll("-",""),name:"",type:"new",stageid:e,parentId:null},{row:i}=yield l.insertAt(d,n);yield l.setActiveCell(i,"name")}),T=(n,l)=>y(this,null,function*(){const d=_.value;if(l==="current"){const i={name:"\u65B0\u6570\u636E",id:Date.now(),parentId:n.parentId,date:k.toDateString(new Date,"yyyy-MM-dd")},{row:f}=yield d.insertAt(i,n);yield d.setActiveRow(f)}else if(l==="top"){const i={name:"\u65B0\u6570\u636E",id:Date.now(),parentId:n.id,date:k.toDateString(new Date,"yyyy-MM-dd")},{row:f}=yield d.insert(i);yield d.setTreeExpand(n,!0),yield d.setActiveRow(f)}else if(l==="bottom"){const i={name:"\u65B0\u6570\u636E",id:Date.now(),stageid:e,parentId:n.id,date:k.toDateString(new Date,"yyyy-MM-dd")},{row:f}=yield d.insertAt(i,-1);yield d.setTreeExpand(n,!0),yield d.setActiveCell(f,"name")}}),D=n=>y(this,null,function*(){(yield A.modal.confirm("\u60A8\u786E\u5B9A\u8981\u5220\u9664\u8BE5\u6570\u636E?"))==="confirm"&&(yield _.value.remove(n))});function B(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){let l=Math.random()*16|0;return(n=="x"?l:l&3|8).toString(16)})}return(n,l)=>{const d=g("vxe-input"),i=g("vxe-button"),f=g("vxe-toolbar"),R=g("vxe-column"),te=g("vxe-table");return P(),Y(s(se),{dense:"",contentFullHeight:"",fixedHeight:"",contentClass:"flex"},{default:u(()=>[a(Be,{onSelect:m,style:{margin:"6px 0 6px 6px",flex:"0 0 280px"}}),b("div",Ve,[a(f,{ref:(c,w)=>{w.xToolbar=c,x.value=c},export:"",refresh:"",custom:""},{buttons:u(()=>[a(d,{modelValue:s(r).filterName,"onUpdate:modelValue":l[0]||(l[0]=c=>s(r).filterName=c),placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",onKeyup:s(t)},null,8,["modelValue","onKeyup"]),a(i,{status:"primary"},{default:u(()=>[$e]),_:1}),a(i,{onClick:l[1]||(l[1]=c=>o(-1))},{default:u(()=>[je]),_:1}),a(i,{onClick:l[2]||(l[2]=c=>n.$refs.xTable.setAllTreeExpand(!0))},{default:u(()=>[Ae]),_:1}),a(i,{onClick:l[3]||(l[3]=c=>n.$refs.xTable.clearTreeExpand())},{default:u(()=>[ke]),_:1})]),tools:u(()=>[b("button",{style:{"margin-right":"10px"},onClick:S,class:"vxe-button type--button size--small is--circle",type:"button",title:"\u5BFC\u5165"},Ie)]),_:1},512),a(te,{resizable:"","show-overflow":"",ref:(c,w)=>{w.xTable=c,_.value=c},"export-config":E,"tree-config":{transform:!0},"edit-config":{trigger:"click",mode:"row"},"checkbox-config":{labelField:"id"},data:s(r).tableData},{default:u(()=>[a(R,{width:"35"},{default:u(()=>[Se]),_:1}),a(R,{field:"name","tree-node":"",title:"\u4EFB\u52A1\u540D\u79F0","edit-render":{}},{edit:u(({row:c})=>[a(d,{modelValue:c.name,"onUpdate:modelValue":w=>c.name=w,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(R,{field:"size",title:"\u8D1F\u8D23\u4EBA","edit-render":{}},{edit:u(({row:c})=>[a(d,{modelValue:c.size,"onUpdate:modelValue":w=>c.size=w,type:"text"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(R,{field:"date",title:"\u622A\u6B62\u65F6\u95F4","edit-render":{}},{edit:u(({row:c})=>[a(d,{modelValue:c.date,"onUpdate:modelValue":w=>c.date=w,type:"date",transfer:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(R,{title:"\u64CD\u4F5C",width:"100","show-overflow":"","header-align":"center",align:"right"},{default:u(({row:c})=>[a(s(ce),{onClick:w=>T(c,"bottom"),style:{"font-size":"15px","margin-left":"10px",color:"#52C41A"}},null,8,["onClick"]),a(s(X),{onClick:w=>s(be)({id:c.id},s(V)),style:{"font-size":"15px","margin-left":"11px",color:"#2874C5"}},null,8,["onClick"]),a(s(Q),{onClick:w=>D(c),style:{"font-size":"15px","margin-left":"10px",color:"#ED6F6F"}},null,8,["onClick"])]),_:1})]),_:1},8,["data"])]),a(Ce,{onRegister:s(h),onSuccess:F},null,8,["onRegister"])]),_:1})}}const et=H(G(J({},Ue),{setup:Re}));export{et as default};
